import {
  Meta,
  Story,
  Preview,
  Props,
  Source
} from "@storybook/addon-docs/blocks";
import { useState } from "react";
import { action } from '@storybook/addon-actions';
import PropTypes from "prop-types";
import { v4 } from 'uuid';

import { storiesOf } from "@storybook/react";
import {
  withKnobs,
  select,
  text,
  number,
  boolean,
  optionsKnob as options
} from "@storybook/addon-knobs";

import { ImportPath, arrayToOptions, State } from "components/util/storybook";

import Toaster, { Toaster as RawToaster } from "components/interactive/Toaster";
import Toast from "components/interactive/Toast";

<Meta
  title="Components/Interactive/Toaster"
  decorators={[withKnobs]}
  component={Toaster}
/>

# Toaster

<ImportPath component={RawToaster} section="interactive" />

Controller for positioning, transition, and dismissal of toasts.

<Story name="Knobs">
  {() => {   
    const [isToastShowing, setIsToastShowing] = useState(false);
    return (
      <>
        <button onClick={() => setIsToastShowing(!isToastShowing)}>{isToastShowing ? 'Hide Toaster' : 'Show Toaster'}</button>
        <Toaster
          isOpen={isToastShowing}
          onDismiss={() => setIsToastShowing(false)}
          dismissDelay={number("dismissDelay", undefined)}
          dismissToast={action('dismissToast')}
          isAutoDismiss={boolean("isAutoDismiss", undefined)}
          toastProps={{
            content: text("content", "hey"),
            type: options(
              "type",
              arrayToOptions(['error', 'success', 'info', 'progress']),
              'info',
              { display: "inline-radio" }
            ),
            progress: number("progress", 42, {
              range: true,
              min: 1,
              max: 100,
              step: 1
            }),
            canDismiss: boolean("canDismiss", undefined),
            dismissOnAction: boolean("dismissOnAction", true),
            actionLabel: text("actionLabel", 'Action'),
            onAction: action('onAction')
          }}
        />
      </>
    )
  }}
</Story>

<Story name="Rendering" parameters={{ docs: { disable: true }}}>
  {() => {   
    const [params, setParams] = useState({ id: v4(), isOpen: false, isAutoDismiss: true });
    const [isShadow, setIsShadow] = useState(false);
    const dismissToast = () => {
      setParams({ ...params, isOpen: false })
    }
    const { id, type, isOpen, content, isAutoDismiss } = params;
    return (
      <div className={isShadow ? "elevation--1 padding--all" : "padding--all"}>
        <button onClick={() => setIsShadow(!isShadow)}>{isShadow ? 'Hide Shadow' : 'Show Shadow'}</button>
        <button onClick={() => setParams({ ...params, isOpen: true })}>Open Toast</button>
        <button onClick={() => setParams({ ...params, isOpen: false })}>Close Toast</button>
        <button onClick={() => setParams({ ...params, isAutoDismiss: !isAutoDismiss })}>Toggle isAutoDismiss {isAutoDismiss ? "off" : "on"}</button>
        <button onClick={() => setParams({ ...params, id: v4(), type: "error", isOpen: true, content: 'New ID? Yes!' })}>Error Toast (new id)</button>
        <button onClick={() => setParams({ ...params, id: v4(), type: "info", isOpen: true, content: 'New ID? Yes!' })}>Info Toast (new id)</button>
        <button onClick={() => setParams({ ...params, id: id, type: "error", isOpen: true, content: 'New ID? No.'  })}>Error Toast (no new id)</button>
        <br />
        <br />
        <b>NOTE: this is state is EXTERNAL to toaster and is being passed in</b>
        <pre>
          {JSON.stringify(params, null, 1)}
        </pre>
        <Toaster
          id={id}
          isOpen={isOpen}
          onDismiss={dismissToast}
          isAutoDismiss={isAutoDismiss}
          toastProps={{
            type,
            content
          }}
        />
      </div>
    )
  }}
</Story>

<Props of={RawToaster} />

Important notes:

- **⚠️ Include only one `Toaster` component per application** to ensure that only one toast is rendered at a time.
- Anytime `content` or `type` is added or modified, the Toast will animate out, and a new Toast will take it's place. 
- Any other modified props will change the Toast in place, without triggering re-animation.
